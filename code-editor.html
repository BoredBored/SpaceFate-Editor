<!DOCTYPE html>
<html lang="en-US">

	<head>
		<meta charset="utf-8">
		<title>Spacefate Editor</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src='http://codemirror.net/lib/codemirror.js'></script>
		<script src='http://codemirror.net/mode/xml/xml.js'></script>
		<script src='http://codemirror.net/mode/javascript/javascript.js'></script>
		<script src='http://codemirror.net/mode/css/css.js'></script>
		<script src="http://codemirror.net/addon/edit/matchbrackets.js"></script>
		<script src='http://codemirror.net/mode/htmlmixed/htmlmixed.js'></script>
		<link rel='stylesheet' href='http://codemirror.net/lib/codemirror.css'>
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
		<style type='text/css'>
			.CodeMirror {
				height: auto;
				width: auto;
			}
			iframe {
				border: 1px solid black;
				height: auto;
				width: auto;
			}
			#goToButton {
				display: none;
				position: fixed;
				bottom: 20px;
				right: 30px;
				z-index: 99;
			}
		</style>
	</head>
	<body class="noscript">
		<!-- Top nav -->
		<div class="w3-container">
			<div class="w3-bar w3-border w3-card-4 w3-light-grey w3-margin-bottom">
				<button class="w3-bar-item w3-button" id="SideBar">&#9776;</button> 
				<a href="#" class="w3-bar-item w3-button">Home</a> 
				<a href="#" class="w3-bar-item w3-button w3-right">Link</a>
			</div>
		</div>
		<!-- Sidebar -->
		<div class="w3-container">
			<div class="w3-sidebar w3-bar-block w3-card-2 w3-animate-left" style="display:none" id="Sidebar">
				<button class="w3-bar-item w3-button w3-large w3-right-align" onclick="w3_close()" style="font-weight: bold;">&times;</button>
            				<a href="#" class="w3-bar-item w3-button w3-hover-none w3-padding-16 w3-large"><u>Mode</u></a>
					<a href="#" class="w3-bar-item w3-button w3-right-align">Visual Editor</a> 
              				<a href="#" class="w3-bar-item w3-button w3-right-align">Terminal</a> 
					<a href="#" class="w3-bar-item w3-button w3-right-align">Server Info Page</a> 
        		</div>
		</div>
			<!-- Code editor -->
		<div id="main">
			<div class="w3-container">
				<div class="w3-bar w3-margin-bottom w3-light-grey">
					<input id="upload" type="file" class="w3-bar-item w3-input w3-tiny" style="curser:default" onchange="loadfile(this)" />
					<a class="w3-bar-item w3-button w3-hover-none" href="#download" title="Download this as a file" onclick='saveTextAsFile()'>Download</a>
					<input id="saveAs" type="text" maxlength="50" class="w3-bar-item w3-input" placeholder="Save file as ..." />
				</div>
			</div>
			<div class="w3-container">
				<!-- textarea -->
				<textarea id="code" name="code"><!DOCTYPE html>
<html>
	<head lang="en-US">
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<script src="https://www.w3schools.com/lib/w3.js"></script>
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	</head>
	<body>
			
	</body>
<html></textarea>
				<!-- End textarea -->
				<button class="w3-button w3-red" id="goToButton"></button>
			</div>
		</div>
		<script>
			var delay;
			// Initialize CodeMirror editor
			var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
				mode: 'text/html',
				tabMode: 'indent',
				lineNumbers: true,
				lineWrapping: true,
				autoCloseTags: true,
				matchBrackets: true
			});
			// Live preview
			editor.on("change", function() {
				clearTimeout(delay);
				delay = setTimeout(updatePreview, 300);
			});
			function updatePreview() {
				var previewFrame = document.getElementById('preview');
				var preview = previewFrame.contentDocument || previewFrame.contentWindow.document;
				preview.open();
				preview.write(editor.getValue());
				preview.close();
			}
			setTimeout(updatePreview, 300);
			function saveTextAsFile() {
				var textToWrite = document.getElementById("code").value;
				var textFileAsBlob = new Blob([textToWrite], {
					type: 'text/html'
				});
				var fileNameToSaveAs = document.getElementById('saveAs').value;
				if (fileNameToSaveAs !== "") {
					var downloadLink = document.createElement("a");
					downloadLink.download = fileNameToSaveAs;
					downloadLink.innerHTML = "Download File";
					if (window.webkitURL != null) {
						// Chrome allows the link to be clicked
						// without actually adding it to the DOM.
						downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
					}
					else {
						// Firefox requires the link to be added to the DOM
						// before it can be clicked.
						downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
						downloadLink.onclick = destroyClickedElement;
						downloadLink.style.display = "none";
						document.body.appendChild(downloadLink);
					}
					downloadLink.click();
				} 
				else {
					alert("Please input a file name.");
				}
			}

			function destroyClickedElement(event) {
				document.body.removeChild(event.target);
			}

			function loadfile(input) {
				var reader = new FileReader();
				reader.onload = function(e) {
					editor.setValue(e.target.result);
				}
				reader.readAsText(input.files[0]);
				var fileInput = document.getElementById('upload');
				document.getElementById('saveAs').value = fileInput.files[0].name;
			}
			var input = document.getElementById("select");

			function selectTheme() {
				var theme = input.options[input.selectedIndex].innerHTML;
				editor.setOption("theme", theme);
			}

			var choice = document.location.search && decodeURIComponent(document.location.search.slice(1));

			if (choice) {
				input.value = choice;
				editor.setOption("theme", choice);
			}

			document.getElementById("SideBar").onclick = function() { w3_open()};

			function w3_open() {
				document.getElementById("main").style.marginLeft = "16%";
				document.getElementById("Sidebar").style.width = "15%";
				document.getElementById("Sidebar").style.display = "block";
			}

			function w3_close() {
				document.getElementById("main").style.marginLeft = "0%";
				document.getElementById("Sidebar").style.display = "none";
			}

			function PreToggle() {
				var x = document.getElementById('preview');
				if (x.style.display === 'none') {
					x.style.display = 'block';
				}
				else {
					x.style.display = 'none';
				}
			}
			
			document.getElementById("SideBar").onclick = goToButton;
			
			var goToButton = document.getElementById("goToButton");
			var goToBtnState = false; // false == bottem
			function goToButton() {
				if (goToBtnState == false) {
					goToTopFunc();
					goToBtnState = true;
				} else {
					goToBottemFunc();
					goToBtnState = false;
				}
			}
			
			// When the user scrolls down passed [screenHeight]px show the button
			window.onscroll = function() { scrollFunction() };
			function scrollFunction() {
				if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
					goToButton.innerHTML = "&#9650;";
					goToButton.title = "Go to the Top";
					goToButton.style.display = "block";
					goToBtnState = true;
				}
				else if (document.body.scrollTop < 20 || document.documentElement.scrollTop < 20) {
					goToButton.innerHTML = "&#9660;";
					goToButton.title = "Go to the bottem";
					goToBtnState = false;				
				}
				else {
					document.getElementById("goToButton").style.display = "none";
				}
			}

			// When the user clicks on goToTopButton, scroll to the top of the document
			function goToTopFunc() {
				document.body.scrollTop = 0;
				document.documentElement.scrollTop = 0;
			}

			function goToBottemFunc() {
				document.body.scrollTop = $(document).height();
				document.documentElement.scrollTop = $(document).height();
			}

		</script>	
	</body>

</html>
